#!/bin/sh
# TODO: Add flag parsing and take into account --bindir, --libdir, --prefix and --debug

CFLAGS="-D_POSIX_C_SOURCE=200112L $(sdl2-config --cflags) $CFLAGS"
if [ "$1" = "--debug" ]; then
    CFLAGS="-Og -ggdb -Wall -Wextra -Wpedantic $CFLAGS"
else
    CFLAGS="-O2 $CFLAGS"
fi

rm Makefile
echo "OUTDIR=./build-linux-$(uname -m)" >> Makefile
echo "EXE=nemini" >> Makefile
echo "OBJS=src/main.o src/net.o src/socket.o src/url.o src/error.o src/gemini.o" >> Makefile
echo "CFLAGS=$CFLAGS" >> Makefile
echo "LIBS=-lcrypto -lssl $(sdl2-config --libs)" >> Makefile
echo "OUTFLAG=-o" >> Makefile
echo "DIRSEP=/" >> Makefile

# These are defined so that windows builds can call them what they want
echo "RMFILE=rm -f" >> Makefile
echo "RMDIR=rmdir" >> Makefile
echo "MKDIR=mkdir -p" >> Makefile

# This is not in Makefile.in because nmake does not skip the .POSIX target
echo ".POSIX:" >> Makefile

cat Makefile.in >> Makefile
